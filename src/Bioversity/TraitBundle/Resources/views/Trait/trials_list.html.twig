{% extends '::base_empty.html.twig' %}

{% block javascripts %}
  {{ parent() }}
  {% javascripts
    '@BioversityServerConnectionBundle/Resources/public/js/tags.key.js'
    '@BioversityTraitBundle/Resources/public/js/trait.js'
  %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
  {% endjavascripts %}
{% endblock %}
    
{% block stylesheets %}
    {{ parent() }}
    {% stylesheets
      '@BioversityTraitBundle/Resources/public/css/trait.css'
    %}
        <link href="{{ asset_url }}" rel="stylesheet" type="text/css">
    {% endstylesheets %}
{% endblock %}

{% set tagUnit = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_UNIT') %}
{% set path     = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_PATH') %}
{% set label    = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_LABEL') %}
{% set type     = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_TYPE') %}
{% set domain   = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_DOMAIN') %}
{% set auth     = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_AUTHORITY') %}
{% set lid      = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_LID') %}
{% set namespace= constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_NAMESPACE') %}
{% set version  = constant('Bioversity\\ServerConnectionBundle\\Repository\\Tags::kTAG_VERSION') %}

{% block title %}
    Sub-Unit of {{ unit|url_decode }}
{% endblock %}

{% block body %}
    {% for key,value in trials  %}
        <div class="accordion" id="accordion2">
            <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion2" href="#collapse{{ key }}">
                        {% if structKey == 130 %}
                            {{ value['tag'] }}
                        {% else %}
                            {{ value[93] }}
                        {% endif %}
                        <i class="icon-plus"></i>
                    </a>
                    <div class="clear"></div>
                </div>
                <div id="collapse{{ key }}" class="accordion-body collapse">
                    <div class="accordion-inner">
                        
                        {% if value['tag'] != null %}
                            <div class="node_detail pull-left">
                                <div class="node_detail_label">
                                    <strong>Referred Unit</strong>
                                </div>
                                <div class="node_detail_text">
                                    <a class="accordion-toggle trial_detail" href="{{ path('bioversity_trait_json_trials_detail', { 'unit' : value['tag']|url_encode })}}" value="{{ value['tag'] }}" target="_blank">
                                        {{ value['tag'] }}
                                    </a>
                                </div>
                            </div>
                        {% endif %}
                        
                        {% for k,v in value  %}        
                            {% if k != tagUnit and k != 'tag' and k != 'name' and not v|is_array %}
                                <div class="node_detail pull-left">
                                    <div class="node_detail_label">
                                        <strong>{{ responce['_tag'][k][label]['en'] }}</strong>
                                    </div>
                                    <div class="node_detail_text">{{ v }}</div>
                                </div>
                            {% endif %}   
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}

    {% if pagecount > 1 %}
        <table style="margin: 0 auto; text-align: center;">
            <tr>
                {% if actualpage == 0 %}
                    {% set actualpage = 1 %}
                {% endif %}
                
                <td>
                    {% if actualpage > 1 %}
                        <a href="{{ path('bioversity_trait_json_trials', { 'structKey': structKey, 'unit' : unit, 'page' : actualpage-1 })}}" class="btn">Previous</a>
                    {% endif %}
                    
                    <strong>Page</strong> {{ actualpage }} <strong>of</strong> {{ pagecount }}
                    
                    {% if actualpage < pagecount %}
                        <a href="{{ path('bioversity_trait_json_trials', { 'structKey': structKey, 'unit' : unit, 'page' : actualpage+1 })}}" class="btn">Next</a>
                    {% endif %}
                </td>
            </tr>
        </table>
    {% endif %}
    
{% endblock %}